var Monoceros=function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&o(t,e)}function r(t){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function o(t,e){return(o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function i(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function s(t,e,n){return(s=i()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&o(i,n.prototype),i}).apply(null,arguments)}function c(t){var e="function"==typeof Map?new Map:void 0;return(c=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,i)}function i(){return s(t,arguments,r(this).constructor)}return i.prototype=Object.create(t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),o(i,t)})(t)}function u(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function a(t){return function(){var e,n=r(t);if(i()){var o=r(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return u(this,e)}}function l(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var s,c=t[Symbol.iterator]();!(r=(s=c.next()).done)&&(n.push(s.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{r||null==c.return||c.return()}finally{if(o)throw i}}return n}(t,e)||p(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(t){return function(t){if(Array.isArray(t))return h(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||p(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(t,e){if(t){if("string"==typeof t)return h(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(t,e):void 0}}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var y=function(t){return t===1/0},v=function(t){return"function"==typeof t};function d(t){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function g(t,e){return(g=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function b(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function m(t,e,n){return(m=b()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return n&&g(o,n.prototype),o}).apply(null,arguments)}function w(t){var e="function"==typeof Map?new Map:void 0;return(w=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return m(t,arguments,d(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),g(r,t)})(t)}function O(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}var S=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&g(t,e)}(r,t);var e,n=(e=r,function(){var t,n=d(e);if(b()){var r=d(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return O(this,t)});function r(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),(e=n.call(this)).name=e.constructor.name,e.message=t,e}return r}(w(Error));function Cluster(t){this.parent=t||1/0,this.entities={},this.register=function(t,e,n){n&&v(n)&&(n={type:n}),n=n||{};for(var r=arguments.length,o=new Array(r>3?r-3:0),i=3;i<r;i++)o[i-3]=arguments[i];this.entities[t]={$uninitialized:e,$type:n.type||Cluster.Body,$dependencies:n.dependencies||e.$dependencies||[],$args:o&&o.length>0?o:[]}},this.createCluster=function(){return new Cluster(this)},this.resolve=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];if(n=n||[],this.entities.hasOwnProperty(t))return this.applyEntityType(t,n).resolve();if(!y(this.parent)&&this.parent.entities.hasOwnProperty(t))return this.parent.applyEntityType(t,n).resolve();throw new S('Could not resolve entity named "'.concat(t,'"'))},this.applyEntityType=function(t,e){var n=this.entities[t],r=n,o=r.$uninitialized,i=r.$type,s=r.$dependencies,c=r.$args;return o?(n=this.resolveDependencies(o,s,c.concat(e)),this.entities[t]=new i(n),this.entities[t]):n},this.resolveDependencies=function(t,e,n){var r=this;if(!v(t))return t;if(0===e.length&&0===n.length)return t;var o=[];return e.length>0&&e.forEach((function(t){o.push(r.resolve(t))})),o.unshift({}),t.bind.apply(t,o.concat(n))}}Cluster.Body=function(t){this.resolve=function(){return t}},Cluster.Singleton=function(t){var e;this.resolve=function(){return e||(e=t()),e}},Cluster.Instance=function(t){this.resolve=function(){return new t}};var E=function(e){return e&&"object"===t(e)&&e.constructor===Object},_=function(t){return t&&Array.isArray(t)},N=function t(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return n.reduce((function(e,n){return Object.keys(n).forEach((function(r){var o=e[r],i=n[r];_(o)&&_(i)?e[r]=o.concat.apply(o,f(i)):E(o)&&E(i)?e[r]=t(o,i):e[r]=i})),e}),{})},j=function(t,e){return"[data-".concat(t).concat(e,"]")},I=function(t,e){return"".concat(t,"in-").concat(e)},x=function(t){return t<10?"0"+t:t},A=function(){var t=new Date,e=x(t.getHours()),n=x(t.getMinutes()),r=x(t.getSeconds()),o=t.getMilliseconds();return"".concat(e,":").concat(n,":").concat(r,".").concat(o)},M=function(t){n(o,t);var r=a(o);function o(t){var n;return e(this,o),(n=r.call(this)).name=n.constructor.name,n.message=t,n}return o}(c(Error)),MonocerosCoreError=function(t){n(MonocerosCoreError,t);var r=a(MonocerosCoreError);function MonocerosCoreError(t){return e(this,MonocerosCoreError),r.call(this,t)}return MonocerosCoreError}(M),P=new Cluster;P.register("defaultOptions",{classNamePrefix:"u_",selectorPrefix:"monoceros-",debug:!1,base:{viewport:"viewport",container:"container",item:"item"}}),P.register("version","1.0.2"),P.register("createOptions",(function(){var t=N.apply(void 0,arguments);if(t.base){t.selectors||(t.selectors={}),t.classNames||(t.classNames={});for(var e=0,n=Object.entries(t.base);e<n.length;e++){var r=l(n[e],2),o=r[0],i=r[1];t.selectors[o]=j(t.selectorPrefix,i),t.classNames["in_"+o]=I(t.classNamePrefix,i)}}return t})),P.register("createObserver",(function(t){var e=t.root,n=t.className,r=t.threshold,o=t.rootMargin,i=t.cb;return r=r||0,o=o||"0px",new IntersectionObserver((function(t){t.forEach((function(t,e){var r=t.isIntersecting,o=t.target;r?o.classList.contains(n)||o.classList.add(n):o.classList.contains(n)&&o.classList.remove(n),i&&i(t,e)}))}),{root:e,threshold:r,rootMargin:o})})),P.register("createMonocerosInstance",(function(t){return{el:t,inView:!1,x:{start:0,current:0,end:0},y:{start:0,current:0,end:0}}})),P.register("log",(function(){for(var t,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];(t=console).info.apply(t,["[".concat(A(),"] ")].concat(n))})),P.register("logError",(function(t){console.error=t})),P.register("isArray",_),P.register("MonocerosError",M),P.register("MonocerosCoreError",MonocerosCoreError);return new function(t){var e=this;this.name="@monoceros/core",this.cluster=t,this.plugins=[],this.uninitialized_plugins=[],this.instances=[],this.version=this.cluster.resolve("version")||null,this.log=this.cluster.resolve("log"),this.defaults=this.cluster.resolve("defaultOptions"),this.options=this.cluster.resolve("createOptions",this.defaults)(),this.MonocerosCoreError=this.cluster.resolve("MonocerosCoreError"),this.set=function(t){return t.debug&&e.log("SETTING OPTIONS"),e.options=e.cluster.resolve("createOptions")(e.options,t),e},this.use=function(t,n){if(e.options.debug&&e.log("USING PLUGIN"),t){var r=e.cluster.resolve("isArray"),o=[];if(r(t))t.forEach((function(t){if(r(t))return o.push(t);o.push([t,{}])}));else{var i=t;o.push([i,n||{}])}return e.uninitialized_plugins=e.uninitialized_plugins.concat(o),e}e.options.debug&&e.log("No plugins found to be initialized. Make sure to pass a plugin function to .use()")},this.init=function(){var t=this;this.options.debug&&this.log("STARTING INIT"),this.cluster.register("options",this.options);var e=this.cluster.resolve("createObserver");return function(){if(t.options.debug&&t.log("-- init viewport"),t.dom={html:document.documentElement,body:document.body,viewport:document.querySelector(t.options.selectors.viewport)},!t.dom.viewport)throw new t.MonocerosCoreError("Missing ".concat(t.options.selectors.viewport," element. Canceling Monoceros initialization."));t.dom.viewport.nodeType&&(t.dom.viewport.style="\n          position: fixed;\n          height: 100vh;\n          width: 100vw;\n          overflow-x: hidden;\n          overflow-y: scroll;\n        "),t.cluster.register("dom",t.dom)}(),function(){t.options.debug&&t.log("-- init containers");var n=e({root:t.dom.viewport,className:t.options.classNames.in_viewport}),r=document.querySelectorAll(t.options.selectors.container);0!==r.length?r.forEach((function(t){t.style="\n          overflow: hidden;\n          position: relative;\n        ",n.observe(t)})):t.options.debug&&t.log("No ".concat(t.options.selectors.container," elements found. If you are expecting containers, check your html for naming issues."))}(),function(){t.options.debug&&t.log("-- init instances");var n=t.cluster.resolve("createMonocerosInstance"),r=f(document.querySelectorAll(t.options.selectors.item));if(0!==r.length){r.forEach((function(e){t.instances.push(n(e))}));var o=e({root:t.dom.viewport,className:t.options.classNames.in_viewport});t.instances.forEach((function(n){var r=n.el;o.observe(r);var i=r.closest(t.options.selectors.container);i?e({root:i,className:t.options.classNames.in_container}).observe(r):r.classList.add(t.options.classNamePrefix+"no-container-parent")}))}else options.debug&&t.log("No ".concat(t.options.selectors.item," elements found. If you are expecting them to be found, check your html elements for naming issues."))}(),t.options.debug&&t.log("-- init plugins"),0!==t.uninitialized_plugins.length?t.plugins=t.uninitialized_plugins.map((function(e){var n=l(e,2),r=n[0],o=n[1],i=new r(t.cluster,o);return i.init(),t.options.debug&&t.log('-- initialized plugin "'.concat(i.name,'"')),i})):t.options.debug&&t.log("No plugins found."),this.options.debug&&this.log("INIT FINISHED"),{name:this.name,version:this.version,plugins:this.plugins,options:this.options,cluster:this.cluster}}}(P)}();
