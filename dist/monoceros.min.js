function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function i(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function s(e,t,n){return(s=i()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&o(i,n.prototype),i}).apply(null,arguments)}function c(e){var t="function"==typeof Map?new Map:void 0;return(c=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return s(e,arguments,r(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),o(i,e)})(e)}function a(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return function(){var t,n=r(e);if(i()){var o=r(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return a(this,t)}}function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var s,c=e[Symbol.iterator]();!(r=(s=c.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw i}}return n}(e,t)||p(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e){return function(e){if(Array.isArray(e))return d(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||p(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){if(e){if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var h=function(e){return e===1/0},v=function(e){return"function"==typeof e},g=function(e){return Array.isArray(e)};function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function w(e,t,n){return(w=m()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&b(o,n.prototype),o}).apply(null,arguments)}function I(e){var t="function"==typeof Map?new Map:void 0;return(I=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return w(e,arguments,y(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),b(r,e)})(e)}function _(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}var E=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(r,I(Error));var t,n=(t=r,function(){var e,n=y(t);if(m()){var r=y(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return _(this,e)});function r(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=n.call(this)).name=t.constructor.name,t.message=e,t}return r}();function Cluster(e){this.parent=e||1/0,this.entities={},this.register=function(e,t,n){if(!e)throw new E("Entity name must be provided");if(!t)throw new E("Could not find entity trying to be registered as ".concat(e));n&&(v(n)&&(n={type:n}),g(n)&&(n={dependencies:n})),n=n||{};for(var r=arguments.length,o=new Array(r>3?r-3:0),i=3;i<r;i++)o[i-3]=arguments[i];this.entities[e]={$uninitialized:t,$type:n.type||Cluster.Body,$dependencies:n.dependencies||t.$dependencies||[],$args:o&&o.length>0?o:[]}},this.createCluster=function(){return new Cluster(this)},this.resolve=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(!e)throw new E("Resolve requires the name of an entity to resolve");if(n=n||[],this.entities.hasOwnProperty(e))return this.applyEntityType(e,n).resolve();if(!h(this.parent)&&this.parent.entities.hasOwnProperty(e))return this.parent.applyEntityType(e,n).resolve();throw new E('Could not resolve entity named "'.concat(e,'"'))},this.applyEntityType=function(e,t){var n=this.entities[e],r=n,o=r.$uninitialized,i=r.$type,s=r.$dependencies,c=r.$args;return o?(n=this.resolveDependencies(o,s,c.concat(t)),this.entities[e]=new i(n),this.entities[e]):n},this.resolveDependencies=function(e,t,n){var r=this;if(!v(e))return e;if(0===t.length&&0===n.length)return e;var o=[];return t.length>0&&t.forEach((function(e){o.push(r.resolve(e))})),o.unshift({}),e.bind.apply(e,o.concat(n))}}Cluster.Body=function(e){this.resolve=function(){return e}},Cluster.Singleton=function(e){var t;this.resolve=function(){return t||(t=e()),t}},Cluster.Instance=function(e){this.resolve=function(){return new e}};var O=function(t){return t&&"object"===e(t)&&t.constructor===Object},x=function(e){return e&&Array.isArray(e)},S=function e(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.reduce((function(t,n){return Object.keys(n).forEach((function(r){var o=t[r],i=n[r];x(o)&&x(i)?t[r]=o.concat.apply(o,f(i)):O(o)&&O(i)?t[r]=e(o,i):t[r]=i})),t}),{})},P=function(e,t){return"[data-".concat(e).concat(t,"]")},M=function(e,t){return"".concat(e).concat(t)},j=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=1;n<t+1;n++){var r=Math.pow(10,n),o=Array(n+1-t).fill("0").join("");if(e<r)return o+e}return e},A=function(){var e=new Date,t=j(e.getHours()),n=j(e.getMinutes()),r=j(e.getSeconds()),o=j(e.getMilliseconds(),2);return"".concat(t,":").concat(n,":").concat(r,".").concat(o)},C=function(e,t,n,r){r.forEach((function(r){var o=e.selectorPrefix,i=parseInt(r.target.dataset[n(o+"index")]),s=t[i];if(s){var c=r.isIntersecting&&!s.isIntersecting,a=!r.isIntersecting&&s.isIntersecting,u="in-"+e.base.viewport;c?(s.isIntersecting=!0,r.target.classList.add(u)):a&&(s.isIntersecting=!1,r.target.classList.remove(u))}}))},T=function(e,t,n,r){r.forEach((function(r){var o=e.selectorPrefix,i=parseInt(r.target.dataset[n(o+"index")]),s=t[i];if(s){var c=r.isIntersecting&&!s.isIntersecting,a=!r.isIntersecting&&s.isIntersecting,u="in-"+e.base.viewport;c?(s.children.forEach((function(e){s.observers.viewport.observe(e.el),s.observers.section.observe(e.el)})),s.isIntersecting=!0,r.target.classList.add(u)):a&&(s.observers.viewport.disconnect(),s.observers.section.disconnect(),s.children.forEach((function(e){e.el.classList.contains(u)&&e.el.classList.remove(u)})),s.isIntersecting=!1,r.target.classList.remove(u))}}))},N=function(e,t,n,r){r.forEach((function(r){var o=e.selectorPrefix,i=parseInt(r.target.dataset[n(o+"index")]),s=parseInt(r.target.dataset[n(o+"parent")]),c=t[s].children[i],a=r.isIntersecting&&c.isIntersectingParent,u=!r.isIntersecting||!c.isIntersectingParent,l="in-"+e.base.viewport,f=r.target.classList.contains(l);a&&!c.isIntersecting&&(c.isIntersecting=!0,r.target.classList.add(l)),u&&c.isIntersecting&&(c.isIntersecting=!1,r.target.classList.remove(l)),c.isIntersecting&&!f&&r.target.classList.add(l),!c.isIntersecting&&f&&r.target.classList.remove(l)}))},R=function(e,t,n,r){r.forEach((function(r){var o=e.selectorPrefix,i=parseInt(r.target.dataset[n(o+"index")]),s=parseInt(r.target.dataset[n(o+"parent")]),c=t[s].children[i],a=r.isIntersecting&&!c.isIntersectingParent,u=!r.isIntersecting&&c.isIntersectingParent;a&&(c.isIntersectingParent=!0),u&&(c.isIntersectingParent=!1)}))},L=function(e){n(o,c(Error));var r=u(o);function o(e){var n;return t(this,o),(n=r.call(this)).name=n.constructor.name,n.message=e,n}return o}(),MonocerosCoreError=function(e){n(MonocerosCoreError,L);var r=u(MonocerosCoreError);function MonocerosCoreError(e){return t(this,MonocerosCoreError),r.call(this,e)}return MonocerosCoreError}(),z=new Cluster;z.register("options.default",{classNamePrefix:"m-",selectorPrefix:"monoceros-",debug:!1,base:{viewport:"viewport",section:"section",item:"item",rogue:"rogue"},rootMargin:{parent:"0px",child:"0px"}}),z.register("options.version","1.0.6"),z.register("options.create",(function(){var e=S.apply(void 0,arguments);if(e.base){e.selectors||(e.selectors={}),e.classNames||(e.classNames={});for(var t=0,n=Object.entries(e.base);t<n.length;t++){var r=l(n[t],2),o=r[0],i=r[1];e.selectors[o]=P(e.selectorPrefix,i),e.classNames[o]=M(e.classNamePrefix,i)}}return e})),z.register("monoceros.createInstance",(function(e,t,n,r){return{type:e,el:t,isIntersecting:!1,isIntersectingParent:null,index:null,parent:{el:n,index:null},children:r||[],observers:{},coordinates:{x:{start:0,current:0,end:0},y:{start:0,current:0,end:0}}}})),z.register("utils.log",(function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=console).info.apply(e,["[".concat(A(),"] ")].concat(n))})),z.register("utils.logError",(function(e){console.error=e})),z.register("utils.isArray",x),z.register("utils.camelCasify",(function(e){return e.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,(function(e,t){return t.toUpperCase()}))})),z.register("errors.MonocerosError",L),z.register("errors.MonocerosCoreError",MonocerosCoreError),z.register("observer.create",(function(e,t){var n=e.root,r=e.threshold,o=e.rootMargin;return r=r||0,o=o||"0px",new IntersectionObserver((function(e){t&&t(e)}),{root:n,threshold:r,rootMargin:o})})),z.register("observer.itemObserver",C,{dependencies:["options","instances","utils.camelCasify"]}),z.register("observer.sectionObserver",T,{dependencies:["options","instances","utils.camelCasify"]}),z.register("observer.childObserver",N,{dependencies:["options","instances","utils.camelCasify"]}),z.register("observer.childParentObserver",R,{dependencies:["options","instances","utils.camelCasify"]});var $=new function(e){var t=this;this.name="@monoceros/core",this.cluster=e,this.plugins=[],this.uninitialized_plugins=[],this.instances=[],this.dom={html:document.documentElement,body:document.body,viewport:null},this.version=this.cluster.resolve("options.version")||null,this.log=this.cluster.resolve("utils.log"),this.options=this.cluster.resolve("options.create")(this.cluster.resolve("options.default")),this.MonocerosCoreError=this.cluster.resolve("errors.MonocerosCoreError"),this.__set_called=!1,this.__use_called=!1,this.__init_called=!1,this.set=function(e){if(t.__use_called||t.__init_called)throw new t.MonocerosCoreError(".set() should be called before calling .use() and/or .init()");return e.debug&&t.log("SETTING OPTIONS"),t.__set_called=!0,t.options=t.cluster.resolve("options.create")(t.options,e),t},this.use=function(e,n){if(t.__init_called)throw new t.MonocerosCoreError(".use() should be called before calling .init()");if(t.options.debug&&t.log("USING PLUGIN"),t.__use_called=!0,e){var r=t.cluster.resolve("utils.isArray"),o=[];if(r(e))e.forEach((function(e){if(r(e))return o.push(e);o.push([e,{}])}));else{var i=e;o.push([i,n||{}])}return t.uninitialized_plugins=t.uninitialized_plugins.concat(o),t}t.options.debug&&t.log("No plugins found to be initialized. Make sure to pass a plugin function to .use()")},this.init=function(){var e=this;this.__init_called=!0,this.options.debug&&this.log("STARTING INIT");this.initItemInstances=function(){var t=e.cluster.resolve("monoceros.createInstance"),n=f(document.querySelectorAll(e.options.selectors.item)),r=[],o=[];return n.forEach((function(n){var i=n.closest(e.options.selectors.section);i?o.push(t(e.options.base.item,n,i)):r.push(t(e.options.base.rogue,n,e.dom.viewport))})),r.forEach((function(t){t.el.classList.add(e.options.classNames.rogue)})),[o,r]},this.initSectionInstances=function(t){var n=e.cluster.resolve("monoceros.createInstance"),r=f(document.querySelectorAll(e.options.selectors.section)),o=[];return r.forEach((function(r){var i=t.filter((function(e){return e.parent.el===r}));o.push(n(e.options.base.section,r,e.dom.viewport,i)),r.style="\n          overflow: hidden;\n          position: relative;\n        "})),o};return function(){if(e.options.debug&&e.log("-- init viewport"),e.dom={html:document.documentElement,body:document.body,viewport:document.querySelector(e.options.selectors.viewport)},!e.dom.viewport)throw new e.MonocerosCoreError("Missing ".concat(e.options.selectors.viewport," element. Canceling Monoceros initialization."));e.dom.viewport.nodeType&&(e.dom.viewport.style="\n          position: fixed;\n          height: 100vh;\n          width: 100vw;\n          overflow-x: hidden;\n          overflow-y: scroll;\n        ")}(),function(){e.options.debug&&e.log("-- init instances"),e.options.debug&&e.log("---- init item instances");var t=l(e.initItemInstances(),2),n=t[0],r=t[1];e.options.debug&&e.log("---- init section instances");var o=e.initSectionInstances(n);e.instances=[].concat(f(o),f(r));var i=e.cluster.resolve("utils.camelCasify"),s=e.options.selectorPrefix;e.instances.forEach((function(t,n){e.instances[n].index=n,t.el.dataset[i(s+"index")]=n,t.type===e.options.base.section&&t.children.forEach((function(t,r){e.instances[n].children[r].parent.index=n,e.instances[n].children[r].index=r,t.el.dataset[i(s+"parent")]=n,t.el.dataset[i(s+"index")]=r}))}))}(),e.options.debug&&e.log("-- init cluster registrations"),e.cluster.register("instances",e.instances),e.cluster.register("options",e.options),e.cluster.register("dom",e.dom),function(){var t=e.cluster.resolve("observer.create"),n=e.cluster.resolve("observer.itemObserver"),r=e.cluster.resolve("observer.sectionObserver"),o=e.cluster.resolve("observer.childObserver"),i=e.cluster.resolve("observer.childParentObserver"),s=t({root:e.dom.viewport,rootMargin:e.options.rootMargin.parent},n),c=t({root:e.dom.viewport,rootMargin:e.options.rootMargin.parent},r),a=t({root:e.dom.viewport,rootMargin:e.options.rootMargin.child},o);e.instances.filter((function(t){return t.type===e.options.base.rogue})).forEach((function(e){return s.observe(e.el)})),e.instances.filter((function(t){return t.type===e.options.base.section})).forEach((function(e){var n=t({root:e.el},i);e.observers.viewport=a,e.observers.section=n,c.observe(e.el)}))}(),e.options.debug&&e.log("-- init plugins"),0!==e.uninitialized_plugins.length?e.plugins=e.uninitialized_plugins.map((function(t){var n=l(t,2),r=n[0],o=n[1],i=new r(e.cluster,o);return i.init(),e.options.debug&&e.log('-- initialized plugin "'.concat(i.name,'"')),i})):e.options.debug&&e.log("No plugins found."),this.options.debug&&this.log("INIT FINISHED"),{name:this.name,version:this.version,plugins:this.plugins,options:this.options,instances:this.instances}}}(z);export default $;
